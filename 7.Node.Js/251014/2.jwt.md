# JWT

JSON WEB TOKEN

서버의 부담없이 검증 가능한 문자열 값

헤더.페이로드.**서명**

## 헤더

토큰의 머리 부분 => 마치...req의 헤더처럼
=> 어떤 알고리즘으로 서명했는가를 담는다

```json
{
    "alg": "HS256",
    "typ": "JWT"
}
```

## 페이로드 (Payload)

전달하고 싶은 실제 데이터.
보통, 사용자 정보나, 권한, 만료 시간 등을 담는다.

```json
{
    "userId": "wnqudgus1234",
    "role": "admin",
    "exp": 1673625000
}
```

## 서명 (signature)

가장 중요한!! 부분!

**서버만 아는 비밀 키(secret)**로
헤더와 페이로드를 묶어서 해시

## JWT의 동작 원리

1. 사용자가 로그인하면,
   서버가 사용자를 확인한 뒤 JWT를 발급한다.

2. 클라이언트는 이 토큰을 저장한다.
   (보통 쿠키나 로컬스토리지)

3. 이후 요청할 때마다 이 토큰을 헤더에 넣는다.

   ```
   Authorization: Bearer <JWT>
   ```

4. 서버는 토큰을 해석하지 않는다.
   단지 **서명을 검증**한다.
   서명이 같으면 “변조되지 않았다”고 판단하고, 요청을 처리한다.

근데...

JWT의 단점...

한 번 해킹되면? 권한을 이용할 수 있다...

그에 대한 문제점을 보강하기 위한 여러가지 노력이 있지만,
오늘 수업에서는 JWT의 간단한 내부 동작 원리를 파악하는 걸 우선할거임!
인지할 것!

중요한 건! 탈취에 대해서 이러다 할 물리적인, 근본적인 방법은 없기 때문에
다음과 같은 설정을 하는 것.

- 만료일
- 누가 발급했는지에 대한 sub

## 내가 알려주고 싶은 또 다른 핵심 키워드

- SHA-256
- 대칭/비대칭

Base64는 정보를 전달하는 데 있어서 기준이 되는 인코딩 방법 및 표
**해시**는 그 말을 검증할 수 있는지 증명하는 방식

### 해시란?

데이터를 고정된 길이의 요약본! 으로 바꾸는 것

같은 입력 => 항상 같은 출력
한 글자라도 다르면? => 완전히 다른 결과

Secure Hash Algorithm

### 해시 알고리즘의 역사적 맥락

컴퓨터가 데이터를 다루기 시작한 20세기 초반
정보 보안의 가장 큰 문제는 역시 위조(변조)

1990년대 초 => MD(Message Digest)

1. SHA-0
2. SHA-1 (1995)
3. SHA-2 (2001)
4. SHA-3 (2015)

SHA256은 가장 널리 쓰이는 해시 알고리즘임!

asdfasdf
asdfadsfadsf
asdfadsfadsfsdaf

고정된 문자열로 변환하는 행위

SHA-1: 이미 충돌 발견 (2017년 구글 SHAttered 프로젝트)
SHA-256: 아직까지 충돌 사례 없음

SHA-1은 160비트, SHA-256은 256비트
=> 어떤 문자열 값을 넣어도 256비트 길이의 고정된 값이 배출된다.
비트 수가 커질수록 충돌 확률이 기하급수적으로 줄어듬.

SHA-512도 있지만... 이건 너무 김 

그래서, 타협을 한게 SHA-256

## HS256은 뭐임? 그러면?

HMAC + SHA256

대칭 키

반댓말은 비대칭 키

HS256은 대칭 키라고 부릅니다.

대칭: 암호화/복호화에 같은 키를 사용한다.
쉽게: 하나의 키를 가지고 데이터를 암호화. 그리고 복호화 => 다시 열때도 같은 키로 연다.
즉, 비밀 키를 공유하지 않는다면, 아무도 내용을 알 수 없다.
이 키는 저래 외부에 노출되어서는 안된다.

## 여기까지 알아봤다면, 이제 JWT구조를 만들어보자!

근데... 이거 어떻게 만들음?

JWT를 직접 만들 수 있는 도구가 필요하다.
base64 + secret => 서명된 해시값을 만들 수 있는 도구가 필요

`crypto`

Node.js의 내장 모듈

핵심: 요약본 => 해시를 만들건데, 내가 누구인지 증명하는 값.
그래서 아무나 만들면 안됌!
=> 암호학적 방식으로 서명이 필요함
=> crypto

대표적 기능: HMAC, 해시 함수

HMAC: 해시 + key
JWT: 